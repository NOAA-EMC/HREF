#! /bin/sh -l

#PBS -o _RUND_/out
#PBS -e _RUND_/err
#PBS -N _JBNME_
#PBS -A _ACCNR_
#PBS -q _QUEUE_
#PBS -l procs=_TASKS_
#PBS -l walltime=00:_WLCLK_:00
#PBS -q debug

set -aeux
export MPI_GROUP_MAX=96
export MACHINE_ID=_MACHINE_ID_
export SCHEDULER=_SCHED_

cd _RUND_

echo "Model started:  " `date`

module load intel
module load mpt
module load adaptive

export TASKSIZE=_TASKS_
export NTHREADS=_THRDS_

export OMP_NUM_THREADS=$NTHREADS
mpiexec=`which mpiexec_mpt`
if [ $NTHREADS -eq 1 ] ; then
#export FCST_LAUNCHER="env LD_LIBRARY_PATH=$LD_LIBRARY_PATH $mpiexec -n $TASKSIZE"
 export FCST_LAUNCHER="$mpiexec -n $TASKSIZE"
else
#export FCST_LAUNCHER="env LD_LIBRARY_PATH=$LD_LIBRARY_PATH $mpiexec -np $TASKSIZE omplace -nt $NTHREADS"
 export FCST_LAUNCHER="$mpiexec -np $TASKSIZE omplace -nt $NTHREADS"
fi

### for ngac
export RUN_ENVIR=dev 
export cyc=00 
export envir=dev
export PARA_CONFIG=_CONFIG_
export CONFIG_FILE=_CONFIGFILE_
export NEMSDIR=_NEMSDIR_
export WORKDIR=_WORKDIR_
export REGSDIR=_REGSDIR_ 
export FCST_SCRIPT_DIR=_NEMSDIR_/tests
export PDY=20120717

export FHSWR=3600.
export FHLWR=3600.

export GRDI=_REGSDIR_/GFS_GOCART_POST/ngac.t00z.gfsanl
export SFCI=_REGSDIR_/GFS_GOCART_POST/ngac.t00z.sfcanl

export wgrib=/home/George.Vandenberghe/nwprod/util/exec/wgrib
export HOMEGLOBAL=/scratch2/portfolios/NCEPDEV/global/save/Shrinivas.Moorthi/para
export FIXGLOBAL=/scratch2/portfolios/NCEPDEV/global/save/Shrinivas.Moorthi/para/fix/fix_am
export FIX_NGAC=/scratch2/portfolios/NCEPDEV/global/save/Shrinivas.Moorthi/para/fix/fix_ngac
#jw export PARM_NGAC=/scratch2/portfolios/NCEPDEV/global/save/Shrinivas.Moorthi/para/parms/parm_ngac
export PARM_NGAC=/scratch1/portfolios/NCEPDEV/nems/save/Jun.Wang/NGAC/NGACv2.0.0/parm

_RUND_/JNGAC_FORECAST.sms.para

echo "Model ended:    " `date`

exit

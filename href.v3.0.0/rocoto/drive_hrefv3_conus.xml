<?xml version="1.0"?>
<!DOCTYPE workflow
[

<!ENTITY STARTYEAR "2019">
<!ENTITY STARTMONTH "06">
<!ENTITY STARTDAY "19">
<!ENTITY STARTHOUR "00">

<!ENTITY ENDYEAR "2021">
<!ENTITY ENDMONTH "12">
<!ENTITY ENDDAY "31">
<!ENTITY ENDHOUR "12">

<!ENTITY USER "Matthew.Pyle">
<!ENTITY ACCOUNT "HREF-T2O">

<!ENTITY HOMEhref "/gpfs/hps3/emc/meso/noscrub/Matthew.Pyle/HREF_fork/href.v3.0.0">
<!ENTITY domain "conus">
<!ENTITY machine "WCOSS_C">
<!ENTITY envir "test">
<!ENTITY JOBS "&HOMEhref;/jobs">
<!ENTITY PRE "&HOMEhref;/rocoto/launch.ksh">

<!ENTITY SCRIPTS "&HOMEhref;/scripts">
<!ENTITY COMINfv3sar "/gpfs/hps2/ptmp/Matthew.Pyle/com/hiresw/para/hiresw"> 
<!-- !ENTITY COMINfv3sar "/gpfs/hps/nco/ops/com/hiresw/para/hiresw"> -->
<!-- <!ENTITY COMINhrrr "/gpfs/hps/nco/ops/com/hrrr/prod/hrrr"> -->
<!ENTITY COMINhrrr "/gpfs/hps/nco/ops/com/hrrr/prod/hrrr">
<!-- <!ENTITY COMINhrrr "/gpfs/hps3/ptmp/Ming.Hu/com/hrrr/para/hrrr"> -->
<!-- <!ENTITY COMINhrrr "/gpfs/hps/ptmp/Benjamin.Blake/com/hrrr/prod/hrrr"> -->
<!ENTITY COMINhiresw "/gpfs/hps/nco/ops/com/hiresw/para/hiresw">
<!ENTITY COMINnam "/gpfs/dell1/nco/ops/com/nam/prod/nam">
<!ENTITY COMINall "/gpfs/hps2/ptmp/Matthew.Pyle/nwges/&envir;/href">
<!ENTITY GESROOT "/gpfs/hps2/ptmp/&USER;/nwges">
<!ENTITY OUTDIR "/gpfs/hps2/ptmp/&USER;">
<!ENTITY MYCOMROOT "/gpfs/hps2/ptmp/&USER;/com">
<!ENTITY MYCOMROOTPERM "/gpfs/hps3/emc/meso/noscrub/&USER;/com">
<!ENTITY DATAROOT "/gpfs/hps2/stmp/&USER;/tmpnwprd">
<!ENTITY KEEPDATA "NO">
<!ENTITY TIMEOFFSET_SIX "-00:06:00:00">
<!ENTITY TIMEOFFSET_TWELVE "-00:12:00:00">


<!ENTITY RESERVATION '<queue>devhigh</queue><account>&ACCOUNT;</account>'>
<!ENTITY RESERVATION_CALIB '<queue>devhigh</queue><account>&ACCOUNT;</account>'>

<!ENTITY QUEUE      "devhigh">

<!ENTITY QUEUE_CALIB     "&QUEUE;">
<!ENTITY WALLTIME_CALIB  "00:39:00">
<!ENTITY RESOURCES_CALIB "<nodes>1:ppn=1</nodes>">
<!ENTITY MEMORY_CALIB    "3000M">
<!ENTITY NATIVE_CALIB    "">

<!ENTITY RESERVATION_TRANSFER '<queue>dev_transfer</queue><account>&ACCOUNT;</account>'>
<!ENTITY TRANSFER_RESOURCES '<nodes>1:ppn=1</nodes><walltime>04:59:00</walltime><shared></shared>'>


<!ENTITY CLEANUP_RESOURCES '<walltime>00:10:00</walltime>'>
<!ENTITY PREPROC_RESOURCES '<walltime>00:25:00</walltime><native></native>'>

<!ENTITY FFG_RESOURCES '<walltime>00:10:00</walltime><native></native>'>
<!ENTITY EAS_RESOURCES '<walltime>00:25:00</walltime><native></native>'>
<!ENTITY ENSPROD_RESOURCES '<walltime>00:25:00</walltime><native></native>'>
<!ENTITY GEMPAK_RESOURCES '<walltime>00:59:00</walltime><native></native>'>

]>


<!--  ************************************************************* -->
<!--  ******************* STARTING THE WORKFLOW ******************* -->

<!-- <workflow realtime="F" scheduler="lsfcray" taskthrottle="11"> -->
<workflow realtime="T" scheduler="lsfcray" taskthrottle="60" cyclethrottle="12" cyclelifespan="01:23:30:00">

  <cycledef group="regional">&STARTYEAR;&STARTMONTH;&STARTDAY;&STARTHOUR;00 &ENDYEAR;&ENDMONTH;&ENDDAY;&ENDHOUR;00 12:00:00</cycledef>
  <cycledef group="regional_justontime">&STARTYEAR;&STARTMONTH;&STARTDAY;&STARTHOUR;00 &ENDYEAR;&ENDMONTH;&ENDDAY;&ENDHOUR;00 12:00:00</cycledef>

  <log>
    <cyclestr>&OUTDIR;/logfiles_href/workflow_regional_&domain;_@Y@m@d@H.log</cyclestr>
  </log>


<!--  **********************************************************************  -->
<!--  **************************** Run preproc ******************************  -->

<!-- Strips needed products from NAM, HRRR, and FV3CAM and interpolates to grid 227 -->

  <task name="preproc_hrrr" cycledefs="regional" maxtries="3">
  &RESERVATION;
  &PREPROC_RESOURCES;
  <nodes>7:ppn=7</nodes>
    <command>&PRE; &JOBS;/JHREF_PREPROC_HRRR</command>
    <jobname><cyclestr>preprochrrr_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/preprochrrr_&domain;_@H.log</cyclestr></join>

    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>

    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value>preprochrrr_&domain;</value>
    </envar>

    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT;</value>
    </envar>

    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>

    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>

    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>

    <envar>
      <name>GESROOT</name>
      <value>&GESROOT;</value>
    </envar>

    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>

    <envar>
      <name>COMINnam</name>
      <value>&COMINnam;</value>
    </envar>

    <envar>
      <name>COMINhrrr</name>
      <value>&COMINhrrr;</value>
    </envar>

    <envar>
      <name>COMINfv3</name>
      <value>&COMINfv3sar;</value>
    </envar>

    <envar><name>jobid</name><value>href_ensprodpreprochrrr_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>


    <dependency>
       <and>
       <datadep age="10:00" minsize="300000000"><cyclestr>&COMINhrrr;.@Y@m@d/conus/hrrr.t@Hz.wrfprsf12.grib2</cyclestr></datadep>
       <datadep age="10:00" minsize="300000000"><cyclestr>&COMINhrrr;.@Y@m@d/conus/hrrr.t@Hz.wrfprsf24.grib2</cyclestr></datadep>
       <datadep age="05:00" minsize="300000000"><cyclestr>&COMINhrrr;.@Y@m@d/conus/hrrr.t@Hz.wrfprsf36.grib2</cyclestr></datadep>
       <datadep age="03:00" minsize="300000000"><cyclestr>&COMINhrrr;.@Y@m@d/conus/hrrr.t@Hz.wrfprsf45.grib2</cyclestr></datadep>
       <datadep age="03:00" minsize="300000000"><cyclestr>&COMINhrrr;.@Y@m@d/conus/hrrr.t@Hz.wrfprsf46.grib2</cyclestr></datadep>
       <datadep age="03:00" minsize="300000000"><cyclestr>&COMINhrrr;.@Y@m@d/conus/hrrr.t@Hz.wrfprsf47.grib2</cyclestr></datadep>
       <datadep age="03:00" minsize="300000000"><cyclestr>&COMINhrrr;.@Y@m@d/conus/hrrr.t@Hz.wrfprsf48.grib2</cyclestr></datadep>
       </and>
    </dependency>

  </task>

  <task name="preproc_nam" cycledefs="regional" maxtries="3">
  &RESERVATION;
  &PREPROC_RESOURCES;
  <nodes>6:ppn=10</nodes>
    <command>&PRE; &JOBS;/JHREF_PREPROC_NAM</command>
    <jobname><cyclestr>preprocnam_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/preprocnam_&domain;_@H.log</cyclestr></join>

    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>

    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value>preprocnam_&domain;</value>
    </envar>

    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT;</value>
    </envar>

    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>

    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>

    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
      <name>GESROOT</name>
      <value>&GESROOT;</value>
    </envar>
    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>

    <envar>
      <name>COMINnam</name>
      <value>&COMINnam;</value>
    </envar>

    <envar>
      <name>COMINhrrr</name>
      <value>&COMINhrrr;</value>
    </envar>

    <envar>
      <name>COMINfv3</name>
      <value>&COMINfv3sar;</value>
    </envar>

    <envar><name>jobid</name><value>href_ensprodpreprocnam_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>


    <dependency>
          <datadep age="10:00" minsize="300000000"><cyclestr>&COMINnam;.@Y@m@d/nam.t@Hz.conusnest.hiresf54.tm00.grib2</cyclestr></datadep>
    </dependency>

  </task>

  <task name="preproc_fv3" cycledefs="regional" maxtries="3">
  &RESERVATION;
  &PREPROC_RESOURCES;
  <nodes>6:ppn=10</nodes>
    <command>&PRE; &JOBS;/JHREF_PREPROC_FV3</command>
    <jobname><cyclestr>preprocfv3_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/preprocfv3_&domain;_@H.log</cyclestr></join>

    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>

    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value>preprocfv3_&domain;</value>
    </envar>

    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT;</value>
    </envar>

    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>

    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>

    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
      <name>GESROOT</name>
      <value>&GESROOT;</value>
    </envar>
    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>

    <envar>
      <name>COMINnam</name>
      <value>&COMINnam;</value>
    </envar>

    <envar>
      <name>COMINhrrr</name>
      <value>&COMINhrrr;</value>
    </envar>

    <envar>
      <name>COMINfv3</name>
      <value>&COMINfv3sar;</value>
    </envar>
    <envar><name>jobid</name><value>href_ensprodpreprocfv3_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>

    <dependency>
        <and>
          <datadep age="06:00" minsize="300000"><cyclestr>&COMINfv3sar;.@Y@m@d/hiresw.t@Hz.fv3_5km.f47.&domain;.grib2</cyclestr></datadep>
          <datadep age="06:00" minsize="300000"><cyclestr>&COMINfv3sar;.@Y@m@d/hiresw.t@Hz.fv3_5km.f48.&domain;.grib2</cyclestr></datadep>
        </and>
    </dependency>

  </task>

<!--  ***********************************************************************  -->
<!-- dont forget to do FFG piece                                               -->
<!--  ***********************************************************************  -->

  <task name="ffg_gen" cycledefs="regional" maxtries="2">
    &RESERVATION;
    &FFG_RESOURCES;
    <nodes>1:ppn=1</nodes>
      <command>&PRE; &JOBS;/JHREF_FFG_GEN</command>
      <jobname><cyclestr>ffg_gen_&domain;_@Hz</cyclestr></jobname>
      <join><cyclestr>&OUTDIR;/logfiles_href/ffg_gen_&domain;@H.log</cyclestr></join>
   
      <envar>
        <name>HOMEhref</name>
        <value>&HOMEhref;</value>
      </envar>
      <envar>
        <name>job</name>
        <value>ffg_gen_&domain;</value>
      </envar>
      <envar>
        <name>machine</name>
        <value>&machine;</value>
      </envar>

      <envar>
        <name>USER</name>
        <value>&USER;</value>
      </envar>
      <envar>
        <name>CDATE</name>
        <value><cyclestr>@Y@m@d@H</cyclestr></value>
      </envar>
      <envar>
        <name>PDY</name>
        <value><cyclestr>@Y@m@d</cyclestr></value>
      </envar>
      <envar>
        <name>cyc</name>
        <value><cyclestr>@H</cyclestr></value>
      </envar>
      <envar>
       <name>NEST</name>
       <value>&domain;</value>
      </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>
    <envar><name>jobid</name><value>href_ffggen_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>

      <dependency>
     <and>
       <taskdep task="preproc_hrrr"/>
       <taskdep task="preproc_nam"/>
       <taskdep task="preproc_fv3"/>
       <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f36.conus.grib2</cyclestr></datadep>
       <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f36.conusmem2.grib2</cyclestr></datadep>
     </and>
      </dependency>
  </task>



<!--  *******************************************************************  -->
<!--  ********************** Run the main EAS piece *************************  -->


  <task name="eas_gen_1" cycledefs="regional" maxtries="2">
    &RESERVATION;
    &EAS_RESOURCES;
    <nodes>9:ppn=15</nodes>
      <command>&PRE; &JOBS;/JHREF_EAS_1</command>
      <jobname><cyclestr>easgen_1_&domain;_@Hz</cyclestr></jobname>
      <join><cyclestr>&OUTDIR;/logfiles_href/eas_gen_1_&domain;@H.log</cyclestr></join>
   
    <envar>
      <name>NODES</name>
      <value>9</value>
    </envar>
    <envar>
      <name>NTASK</name>
      <value>132</value>
    </envar>
    <envar>
      <name>PTILE</name>
      <value>15</value>
    </envar>

      <envar>
        <name>HOMEhref</name>
        <value>&HOMEhref;</value>
      </envar>
      <envar>
        <name>job</name>
        <value>eas_gen_&domain;</value>
      </envar>
      <envar>
        <name>machine</name>
        <value>&machine;</value>
      </envar>
      <envar>
        <name>USER</name>
        <value>&USER;</value>
      </envar>
      <envar>
        <name>CDATE</name>
        <value><cyclestr>@Y@m@d@H</cyclestr></value>
      </envar>
      <envar>
        <name>PDY</name>
        <value><cyclestr>@Y@m@d</cyclestr></value>
      </envar>
      <envar>
        <name>cyc</name>
        <value><cyclestr>@H</cyclestr></value>
      </envar>
      <envar>
       <name>NEST</name>
       <value>&domain;</value>
      </envar>
    <envar>
     <name>dom</name>
     <value>&domain;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>
    <envar>
      <name>COMINnam</name>
      <value>&COMINall;</value>
    </envar>
    <envar>
      <name>COMINhrrr</name>
      <value>&COMINall;</value>
    </envar>
    <envar>
      <name>COMINhiresw</name>
      <value>&COMINhiresw;</value>
    </envar>
    <envar>
      <name>COMINfv3</name>
      <value>&COMINall;</value>
    </envar>
    <envar><name>jobid</name><value>href_qpfeasfrac_1_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>


      <dependency>
        <and>
           <taskdep task="preproc_fv3"/>
           <taskdep task="preproc_hrrr"/>
           <taskdep task="preproc_nam"/>
           <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f36.conus.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f36.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conus.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/hrrr.t@Hz.conus.f48.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINall;.@Y@m@d/fv3s.t@Hz.conus.f60.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/nam.t@Hz.f54.grib2</cyclestr></datadep>

        </and>
      </dependency>
  </task>

  <task name="eas_gen_2" cycledefs="regional" maxtries="2">
    &RESERVATION;
    &EAS_RESOURCES;
    <nodes>4:ppn=12</nodes>
      <command>&PRE; &JOBS;/JHREF_EAS_2</command>
      <jobname><cyclestr>easgen_2_&domain;_@Hz</cyclestr></jobname>
      <join><cyclestr>&OUTDIR;/logfiles_href/eas_gen_2_&domain;@H.log</cyclestr></join>
   
    <envar>
      <name>NODES</name>
      <value>4</value>
    </envar>
    <envar>
      <name>NTASK</name>
      <value>48</value>
    </envar>
    <envar>
      <name>PTILE</name>
      <value>12</value>
    </envar>

      <envar>
        <name>HOMEhref</name>
        <value>&HOMEhref;</value>
      </envar>
      <envar>
        <name>job</name>
        <value>eas_gen_&domain;</value>
      </envar>
      <envar>
        <name>machine</name>
        <value>&machine;</value>
      </envar>
      <envar>
        <name>USER</name>
        <value>&USER;</value>
      </envar>
      <envar>
        <name>CDATE</name>
        <value><cyclestr>@Y@m@d@H</cyclestr></value>
      </envar>
      <envar>
        <name>PDY</name>
        <value><cyclestr>@Y@m@d</cyclestr></value>
      </envar>
      <envar>
        <name>cyc</name>
        <value><cyclestr>@H</cyclestr></value>
      </envar>
      <envar>
       <name>NEST</name>
       <value>&domain;</value>
      </envar>
    <envar>
     <name>dom</name>
     <value>&domain;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>
    <envar>
      <name>COMINnam</name>
      <value>&COMINall;</value>
    </envar>
    <envar>
      <name>COMINhrrr</name>
      <value>&COMINall;</value>
    </envar>
    <envar>
      <name>COMINhiresw</name>
      <value>&COMINhiresw;</value>
    </envar>
    <envar>
      <name>COMINfv3</name>
      <value>&COMINall;</value>
    </envar>
    <envar><name>jobid</name><value>href_qpfeasfrac_2_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>


      <dependency>
        <and>
           <taskdep task="preproc_fv3"/>
           <taskdep task="preproc_hrrr"/>
           <taskdep task="preproc_nam"/>
           <taskdep task="eas_gen_1"/>
           <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conus.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conus.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/hrrr.t@Hz.conus.f48.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINall;.@Y@m@d/fv3s.t@Hz.conus.f60.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/nam.t@Hz.f54.grib2</cyclestr></datadep>

        </and>
      </dependency>
  </task>


<!--  ***********************************************************************  -->
<!--  ************************* main ensprod piece *****************************  -->

  <task name="ensprod_1" cycledefs="regional" maxtries="2">
  &RESERVATION;
  &ENSPROD_RESOURCES;
  <nodes>12:ppn=3</nodes>
    <command>&PRE; &JOBS;/JHREF_ENSPROD_1</command>
    <jobname><cyclestr>ensprod_1_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/ensprod_1_&domain;_@H.log</cyclestr></join>

    <envar>
      <name>NTASK</name>
      <value>36</value>
    </envar>
    <envar>
      <name>PTILE</name>
      <value>3</value>
    </envar>

    <envar>
      <name>NTASK_LINK</name>
      <value>36</value>
    </envar>
    <envar>
      <name>PTILE_LINK</name>
      <value>3</value>
    </envar>

    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value><cyclestr>ensprod_&domain;_@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>
    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>
    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>
    <envar>
      <name>COMINnam</name>
      <value>&COMINall;</value>
    </envar>

    <envar>
      <name>COMINhrrr</name>
      <value>&COMINall;</value>
    </envar>

    <envar>
      <name>COMINhiresw</name>
      <value>&COMINhiresw;</value>
    </envar>

    <envar>
      <name>COMINfv3</name>
      <value>&COMINall;</value>
    </envar>

    <envar><name>jobid</name><value>href_ensprodv3_1_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>


    <dependency>
     <and>
     <taskdep task="preproc_hrrr"/>
     <taskdep task="preproc_fv3"/>
     <taskdep task="preproc_nam"/>
     <taskdep task="ffg_gen"/>
     <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f36.conus.grib2</cyclestr></datadep>
     <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f36.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conus.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/hrrr.t@Hz.conus.f48.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINall;.@Y@m@d/fv3s.t@Hz.conus.f60.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/nam.t@Hz.f54.grib2</cyclestr></datadep>
     </and>
    </dependency>

  </task>

  <task name="ensprod_2" cycledefs="regional" maxtries="2">
  &RESERVATION;
  &ENSPROD_RESOURCES;
  <nodes>4:ppn=3</nodes>
    <command>&PRE; &JOBS;/JHREF_ENSPROD_2</command>
    <jobname><cyclestr>ensprod_2_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/ensprod_2_&domain;_@H.log</cyclestr></join>

    <envar>
      <name>NTASK</name>
      <value>12</value>
    </envar>
    <envar>
      <name>PTILE</name>
      <value>3</value>
    </envar>
    <envar>
      <name>NTASK_LINK</name>
      <value>48</value>
    </envar>
    <envar>
      <name>PTILE_LINK</name>
      <value>12</value>
    </envar>

    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value><cyclestr>ensprod_&domain;_@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>
    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>
    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>
    <envar>
      <name>COMINnam</name>
      <value>&COMINall;</value>
    </envar>

    <envar>
      <name>COMINhrrr</name>
      <value>&COMINall;</value>
    </envar>

    <envar>
      <name>COMINhiresw</name>
      <value>&COMINhiresw;</value>
    </envar>

    <envar>
      <name>COMINfv3</name>
      <value>&COMINall;</value>
    </envar>


    <envar><name>jobid</name><value>href_ensprodv3_2_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>


    <dependency>
     <and>
     <taskdep task="preproc_hrrr"/>
     <taskdep task="preproc_fv3"/>
     <taskdep task="preproc_nam"/>
     <taskdep task="ensprod_1"/>
     <taskdep task="ffg_gen"/>
     <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conus.grib2</cyclestr></datadep>
     <datadep age="03:00" minsize="100000000"><cyclestr>&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conus.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="100000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINhiresw;.@Y@m@d/hiresw.t@Hz.arw_5km.f48.conusmem2.grib2</cyclestr></datadep>
           <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/hrrr.t@Hz.conus.f48.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_TWELVE;">&COMINall;.@Y@m@d/fv3s.t@Hz.conus.f60.grib2</cyclestr></datadep>
         <datadep age="03:00" minsize="50000000"><cyclestr offset="&TIMEOFFSET_SIX;">&COMINall;.@Y@m@d/nam.t@Hz.f54.grib2</cyclestr></datadep>
     </and>
    </dependency>

  </task>


<!--  ***********************************************************************  -->
<!--  ************************* WMO/AWIP piece *****************************  -->

  <task name="href_awips" cycledefs="regional" maxtries="2">
  &RESERVATION;
  &GEMPAK_RESOURCES;
  <nodes>1:ppn=1</nodes>
    <command>&PRE; &JOBS;/JHREF_AWIPS</command>
    <jobname><cyclestr>awips_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/awips_&domain;_@H.log</cyclestr></join>


    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value><cyclestr>awips_&domain;_@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>
    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>
    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>

    <envar><name>jobid</name><value>href_awips_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>

    <dependency>
     <and>
     <taskdep task="ensprod_1"/>
     <taskdep task="eas_gen_1"/>
     <taskdep task="ensprod_2"/>
     <taskdep task="eas_gen_2"/>
     </and>
    </dependency>

  </task>


<!--  *** copy files for FFAIR/HMT/WWE *** -->

  <task name="href_gribscp" cycledefs="regional" maxtries="2">
  &RESERVATION_TRANSFER;
  &TRANSFER_RESOURCES;
    <command>&PRE; &JOBS;/JHREF_GRIBSCP_FFAIR</command>
    <jobname><cyclestr>gribscp_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/gribscp_&domain;_@H.log</cyclestr></join>


    <envar>
      <name> PTILE </name>
      <value>1</value>
    </envar>
    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value><cyclestr>gribscp_&domain;_@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>
    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>
    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>

    <dependency>
     <and>
     <taskdep task="ensprod_2"/>
     <taskdep task="eas_gen_2"/>
     </and>
    </dependency>

  </task>


<!--  ***********************************************************************  -->
<!--  ************************* GEMPAK piece *****************************  -->

  <task name="href_gempak" cycledefs="regional" maxtries="1">
  &RESERVATION;
  &GEMPAK_RESOURCES;
  <nodes>1:ppn=8</nodes>
    <command>&PRE; &JOBS;/JHREF_GEMPAK</command>
    <jobname><cyclestr>gempak_&domain;_@H</cyclestr></jobname>
    <join><cyclestr>&OUTDIR;/logfiles_href/gempak_&domain;_@H.log</cyclestr></join>


    <envar>
      <name> PTILE </name>
      <value>8</value>
    </envar>
    <envar>
      <name>HOMEhref</name>
      <value>&HOMEhref;</value>
    </envar>
    <envar>
      <name>job</name>
      <value><cyclestr>gempak_&domain;_@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>machine</name>
      <value>&machine;</value>
    </envar>
    <envar>
      <name>USER</name>
      <value>&USER;</value>
    </envar>
    <envar>
      <name>CDATE</name>
      <value><cyclestr>@Y@m@d@H</cyclestr></value>
    </envar>
    <envar>
      <name>PDY</name>
      <value><cyclestr>@Y@m@d</cyclestr></value>
    </envar>
    <envar>
      <name>cyc</name>
      <value><cyclestr>@H</cyclestr></value>
    </envar>
    <envar>
     <name>NEST</name>
     <value>&domain;</value>
    </envar>
    <envar>
      <name>DATAROOT</name>
      <value>&DATAROOT;</value>
    </envar>
    <envar>
     <name>MYCOMROOT</name>
     <value>&MYCOMROOT; </value>
    </envar>
    <envar>
      <name>MYCOMROOTPERM</name>
      <value>&MYCOMROOTPERM;</value>
    </envar>
    <envar>
      <name>KEEPDATA</name>
      <value>&KEEPDATA;</value>
    </envar>
    <envar>
      <name>envir</name>
      <value>&envir;</value>
    </envar>

    <envar><name>jobid</name><value>href_gempak_&domain;_<cyclestr>@H</cyclestr>_&envir;</value></envar>

    <dependency>
     <and>
     <taskdep task="ensprod_2"/>
     <taskdep task="eas_gen_2"/>
     </and>
    </dependency>

  </task>





</workflow>
